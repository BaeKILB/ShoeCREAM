<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.pj2.shoecream.mapper.SocialImageMapper">
	
	<!-- 소셜 프로필 (소셜 게시물 등록) -->
	<insert id="insertPosts"
		parameterType="com.pj2.shoecream.vo.SocialVO">
		insert into
		social_posts
		values(
		#{posts_idx}
		, #{mem_idx}
		, #{mem_nickname}
		, #{posts_content}
		, #{posts_image1}
		, 0
		, now()
		)
	</insert>

	<!-- 소셜 프로필 (소셜 게시물 정보 가져가기) -->
	<select id="SelectSocialProfile" resultType="com.pj2.shoecream.vo.SocialVO">
		SELECT *
		FROM mem_info mi
		JOIN social_posts sp ON mi.mem_idx = sp.mem_idx
		WHERE mi.mem_idx = #{mem_idx}
	</select>

	<!-- 소셜 스토리 (팔로우한 mem_idx 만 게시글 보이기) -->
	<select id="selectStory" resultType="com.pj2.shoecream.vo.SocialVO">
		SELECT * FROM
		social_posts
		WHERE mem_idx
		IN (SELECT followee_idx FROM social_follows WHERE follower_idx = #{sId})
		ORDER BY posts_date DESC
		LIMIT
		#{startRow}, #{listLimit}
	</select>
	
	<select id="selectCommentsByPostId" resultType="com.pj2.shoecream.vo.SocialCommentVO">
	  SELECT * FROM
	  social_comment
	  WHERE posts_idx = #{posts_idx}
	  ORDER BY comment_date DESC
	</select>
	
	<!-- 소셜 인기페이지 (좋아요 많은 순서) -->
	<select id="selectPopular" resultType="com.pj2.shoecream.vo.SocialVO">
		SELECT * FROM social_posts 
		WHERE likeCount 
		ORDER BY likeCount DESC
	</select>
	
	<select id="selectSocial" resultType="com.pj2.shoecream.vo.SocialVO">
		SELECT * FROM social_posts
		WHERE posts_idx = #{posts_idx}
	</select>
	
	
	<insert id="insertComment" parameterType="com.pj2.shoecream.vo.SocialCommentVO">
        INSERT
        INTO social_comment
        VALUES (
            null                -- comment_idx(댓글 번호)
            , #{posts_idx}      -- posts_idx(댓글의 원본 게시물 글 번호)
            , #{mem_idx}        -- mem_idx(로그인한 회원)
            , #{mem_nickname}   -- mem_nickname
            , #{comment_content}  -- comment_content
            , 0                 -- comment_re_ref(원본 댓글 번호)
            , 0                 -- comment_re_lev(댓글 들여쓰기 레벨)
            , 0                 -- comment_re_seq(댓글 순서번호)
            , now()
        )
	</insert>
	
    <!-- 댓글 쓸때 가져갈 프로필 경로 -->
    <select id="findProfileImageUrlByMemberId" parameterType="int" resultType="string">
        SELECT mem_profileImageUrl
        FROM mem_info
        WHERE mem_idx = #{mem_idx}
    </select>
	

	<update id="updateComment_ref" parameterType="com.pj2.shoecream.vo.SocialCommentVO">
	    UPDATE social_comment
	        SET
	            comment_re_ref = #{comment_idx}
	        WHERE
	            comment_idx = #{comment_idx}
	</update>
	
	<delete id="deleteCommentById">
		DELETE
		FROM social_comment
		WHERE comment_idx = #{comment_idx}
	</delete>
	
</mapper>
