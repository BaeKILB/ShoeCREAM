<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.pj2.shoecream.mapper.AdminMapper">
	<!-- 회원 조회 -->
	<select id="selectMemberInfo" resultType="com.pj2.shoecream.vo.MemberVO">
		SELECT *
			FROM mem_info
				<if test="!searchKeyword.equals('')">
					WHERE 
					<choose>
						<when test="searchType.equals('mem_id')">
							mem_id LIKE CONCAT('%', #{searchKeyword},'%')
						</when>
						<when test="searchType.equals('mem_name')">
							mem_name LIKE CONCAT('%', #{searchKeyword},'%')
						</when>
						<when test="searchType.equals('mem_nickname')">
							mem_nickname LIKE CONCAT('%', #{searchKeyword},'%')
						</when>
						<when test="searchType.equals('mem_rank')">
							mem_rank LIKE CONCAT('%', #{searchKeyword},'%')
						</when>
					</choose>
				</if>
			LIMIT
				#{startRow}
				, #{listLimit}
	</select>
	<select id="selectMemberListCount" resultType="int">
		SELECT COUNT(*)
			FROM mem_info
				<if test="!searchKeyword.equals('')">
					WHERE 
					<choose>
						<when test="searchType.equals('mem_id')">
							mem_id LIKE CONCAT('%', #{searchKeyword},'%')
						</when>
						<when test="searchType.equals('mem_name')">
							mem_name LIKE CONCAT('%', #{searchKeyword},'%')
						</when>
						<when test="searchType.equals('mem_nickname')">
							mem_nickname LIKE CONCAT('%', #{searchKeyword},'%')
						</when>
						<when test="searchType.equals('mem_rank')">
							mem_rank LIKE CONCAT('%', #{searchKeyword},'%')
						</when>
					</choose>
				</if>
	</select>
	<!-- 회원 정보 상세조회 -->
	<select id="getMemberInfo" resultType="com.pj2.shoecream.vo.MemberVO">
		SELECT *
			FROM mem_info
			WHERE mem_idx = #{mem_idx}
	</select>
	<!-- 회원 등업 업데이트 -->
<!-- 	<update id="updateMemberRank"> -->
<!-- 		UPDATE MEMBER -->
<!-- 			SET mem_rank -->
<!-- 	</update> -->

	<!-- 회원 삭제 처리 -->
	<delete id="deleteMember">
		DELETE FROM mem_info
			WHERE mem_idx = #{mem_idx}
	</delete>
	
	<!-- 회원 문의 게시판 조회 -->
	<select id="selectQstBoard" resultType="com.pj2.shoecream.vo.InquiryBoardVO">
		SELECT *
			FROM qst_board
				<if test="!searchType.equals('')">
					WHERE qst_type = #{searchType}
				</if>
				ORDER BY
					qst_board_re_ref DESC
					, qst_board_re_seq ASC
			LIMIT
				#{startRow}
				, #{listLimit}
	</select>
	<select id="getQstListCount" resultType="int">
		SELECT COUNT(*)
			FROM qst_board
				<if test="!searchType.equals('')">
					WHERE qst_type = #{searchType}
				</if>
	</select>


<!--  민진 민진 민진민진민진민진민진민진민진민진민진민진 -->

<!--  중고 상품 조회 -->
<select id="selectProduct">
  SELECT
    p.product_idx,
    p.product_brand,
    p.product_price,
    p.product_info,
    p.product_date,
    i.image1
  FROM jung_product AS p
  LEFT JOIN jung_product AS j ON p.product_idx = j.product_idx
  LEFT JOIN product_image AS i ON p.product_idx = i.product_idx
  WHERE p.product_selector = 0
  <if test="searchType != null and searchKeyword != null">
    <choose>
      <when test="searchType.equals('brand')">
        AND p.product_brand LIKE CONCAT('%', #{searchKeyword},'%')
      </when>
      <when test="searchType.equals('product_info')">
        AND p.product_info LIKE CONCAT('%', #{searchKeyword},'%')
      </when>
      <when test="searchType.equals('code')">
        AND p.product_idx LIKE CONCAT('%', #{searchKeyword},'%')
      </when>
    </choose>
  </if>
  ORDER BY p.product_idx ASC
  LIMIT #{cri.skip}, #{cri.amount}
</select>

 <select id="getTotal" resultType="int">
SELECT COUNT(*)
	FROM board_notice
</select>
  
<!--  경매 상품 조회 -->
<select id="selectauctionmap" >
  SELECT
    a.auction_idx,
    a.auction_brand,
    b.bid_price,
    a.auction_info,
    a.auc_start_price,
    i.image1,
    a.auc_regist_date
  FROM auction_item AS a
  LEFT JOIN product_image AS i ON a.auction_idx = i.product_idx
  LEFT JOIN bid_list AS b ON a.auction_idx = i.product_idx
  WHERE a.auction_selector = 1 
  <if test="searchType != null and searchKeyword != null">
    <choose>
      <when test="searchType.equals('brand')">
        AND a.auction_brand LIKE CONCAT('%', #{searchKeyword},'%')
      </when>
      <when test="searchType.equals('auction_title')">
        AND a.auction_info LIKE CONCAT('%', #{searchKeyword},'%')
      </when>
      <when test="searchType.equals('code')">
        AND a.auction_idx LIKE CONCAT('%', #{searchKeyword},'%')
      </when>
    </choose>
  </if>
  ORDER BY a.auction_idx ASC
  LIMIT #{cri.skip}, #{cri.amount}
</select>

<!-- 중고 상품 신고 -->
<select id="getReportListPaging" resultType="com.pj2.shoecream.vo.ReportVO">
SELECT report_idx, report_content, product_idx, report_div, report_detail
FROM (
    SELECT report_idx, report_content, product_idx, report_div, report_detail, COUNT(*) OVER (PARTITION BY product_idx) AS product_count
    FROM joonggo_report
) AS n1
WHERE product_count >= 5
<choose>
    <when test="!searchKeyword.equals('') and searchType.equals('title')">
        AND report_div LIKE CONCAT('%', #{searchKeyword}, '%')
    </when>
    <when test="!searchKeyword.equals('') and searchType.equals('content')">
        AND report_detail LIKE CONCAT('%', #{searchKeyword}, '%')
    </when>
    <when test="!searchKeyword.equals('') and searchType.equals('title_content')">
        AND report_content LIKE CONCAT('%', #{searchKeyword}, '%')
    </when>
</choose>
ORDER BY report_idx ASC
LIMIT #{cri.amount} OFFSET #{cri.skip}
</select>

<!-- 페이징 -->
 <select id="getPage" resultType="int">
SELECT COUNT(*)
	FROM  joonggo_report
</select>

<!--  중고 신고 삭제  -->
<delete id="deleteReport">
  DELETE r, p
  FROM joonggo_report r
  JOIN jung_product p ON r.product_idx = p.product_idx
  WHERE r.product_idx = #{product_idx}
</delete>
   
</mapper>